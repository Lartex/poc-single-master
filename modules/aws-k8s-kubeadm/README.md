# aws-k8s-kubeadm terraform module

This module creates opinionated Kubernetes Cluster.


## Features

- Installs `cluster_version` Kubernetes version.
- Single master node placed in `public_subnet_id`.
  - SSH connection using `cluster_name` as username and the private key autogenerated with this module allowed from
  `trusted_cidrs`.
- `worker_count` worker nodes placed in `private_subnet_id`.
  - SSH connection using `cluster_name` as username and the private key autogenerated with this module allowed from
  master node.
- Every node is created as spot instance node.
  - Runs on top of Ubuntu 18.04 official AMIs.
  - Docker as container engine.


## Usage

You can see an example:

```hcl
module "demo" {
  source = "./modules/aws-k8s-kubeadm"

  region = "eu-central-1"

  cluster_name    = "demo"
  cluster_version = "1.14.8"

  public_subnet_id  = "subnet-your-public-id"
  private_subnet_id = "subnet-your-public-id"

}
```


## Providers

| Name     | Version |
| -------- | ------- |
| aws      | ~> 2.48 |
| random   | ~> 2.2  |
| template | ~> 2.1  |
| tls      | ~> 2.1  |


## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:-----:|
| cluster\_name | Unique identifier of the cluster. Used as system user to log into the instances | `string` | n/a | yes |
| cluster\_version | Kubernetes version to deploy | `string` | n/a | yes |
| external\_db | Use an external DB | `bool` | `false` | no |
| master\_instance\_type | Instance type used to run Kubernetes control-plane. Choose one: m5.large, m5.xlarge, m5.2xlarge, m5.4xlarge | `string` | `"m5.large"` | no |
| pod\_network\_cidr | Specify range of IP addresses for the pod network. Default to calico default value | `string` | `"192.168.0.0/16"` | no |
| private\_subnet\_id | Private subnet ID where worker nodes will run | `string` | n/a | yes |
| public\_subnet\_id | Public subnet ID where control-plane will run | `string` | n/a | yes |
| rds\_instance\_type | In case you select external\_db this variable contains the rds instance type | `string` | `"db.m5.large"` | no |
| region | AWS Region where cluster will run | `string` | n/a | yes |
| svc\_network\_cidr | Specify range of IP addresses for the service network. Default to kubeadm default value | `string` | `"10.96.0.0/12"` | no |
| trusted\_cidrs | List of allowed cidrs to access the control-plane/cluster | `list` | <pre>[<br>  "0.0.0.0/0"<br>]</pre> | no |
| worker\_count | Number of workers nodes to deploy | `number` | `2` | no |
| worker\_instance\_type | Instance type used to run Kubernetes worker. Choose one: m5.large, m5.xlarge, m5.2xlarge, m5.4xlarge | `string` | `"m5.xlarge"` | no |                     |    no    |


## Outputs

| Name                | Description                                        |
| ------------------- | -------------------------------------------------- |
| master\_public\_ip  | Public IP where control plane is exposed           |
| ssh\_command\_help  | Long command to ssh the control plane              |
| tls\_private\_key   | Private RSA Key to log into the control plane node |
| worker\_private\_ip | Worker nodes private ip list                       |